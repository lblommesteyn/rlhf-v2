<!DOCTYPE html>
<html>
<head>
    <title>Reinforcement Learning Feedback</title>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Open+Sans&display=swap");

        body {
            background-color: #f4f7fc;
            font-family: "Open Sans", sans-serif;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f7fc;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        .classificationDropdown, .nameInput {
            margin-bottom: 10px;
            display: block;
            width: 100%;
        }

        .submitFeedback, .submitName, .addMarkerButton {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
        }

        .markerFeedbackContainer {
            margin-bottom: 15px;
        }

        .markerButton {
            margin-right: 10px;
        }

        hr {
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f4f4f4;
        }

        .markerDiv {
            margin-bottom: 10px;
        }

        .markerDiv label {
            margin-right: 5px;
        }
    </style>
    <script>
        let jsonData = [
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– \nCrucially, directors considered shareholder returns \nand agreed the updated purpose should remain \ngrounded in commercial reality. \n– \nDuring discussions, the Board and Executive \nCommittee (“ExCo”) explored M&S’ rich heritage \nand our place in the communities we serve with \nthe help of our M&S Archive. ",
        "marker": "Purpose",
        "confidence": 65
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– \nFeedback was sought from leaders across the \nbusiness and a wider “Talk Straight Survey” invited \nthe views of all employees. The results identified \nclear communication as an area for improvement, \nand as a result, alignment with our wider “People \nPlan” and colleague communication strategy  \nwere key focus areas in the relaunch. ",
        "marker": "Collaboration",
        "confidence": 70
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "MS2 3  5\nThe Board has monitored progress of MS2,  \nthe Company’s digital and online change  \nprogramme, which was launched last year with  \nthe ambition to bring M&S.com front and centre  \nof our business proposition. \nDecisions and s.172 considerations\n– \nIn reviewing regular updates on MS2’s progress,  \nthe Board monitored and encouraged \nadvancement of growth plans, including \nappropriate investment in talent. ",
        "marker": "Purpose",
        "confidence": 60
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "End-to-end supply chain 1  3  5\nThe Board reviewed regular updates on  \nmodernising supply chains across Food,  \nClothing & Home and International. \nDecisions and s.172 considerations\n– \nGuidance was offered on the roll-out of Vanguarde \nand consideration given to the impact of labour \nshortages and global delays on our partners, store \ncolleagues, agency workers and shareholders.  ",
        "marker": "Tensions",
        "confidence": 55
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Rotating the store estate 4\nEnsuring the store estate is fit for the future \ncontinued to be a key priority during the year.\nDecisions and s.172 considerations\n– \nIn addition to reviewing developments and visiting \nstores, the Board considered how changes in the \ncommunity post-Covid-19 had impacted plans for \nstore locations and encouraged management to \nfocus on store geography during budget planning. ",
        "marker": "Macro Issue How",
        "confidence": 50
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Strategic investments 3\nCEO and CFO updates included reports on proposed \nand in-flight strategic investments and acquisitions, \nincluding on Nobody’s Child, The Sports Edit and  \nTrue Capital III Fund. \nDecisions and s.172 considerations\n– \nAs part of the Brands strategy, the Board \nchallenged management on integration with  \nM&S colleagues and culture, long-term returns  \nfor investors, and adding value to the customer \nproposition. ",
        "marker": "Tensions",
        "confidence": 60
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Digital & Data 1  2  3  4  5\nThe “Digital First” agenda has remained a focal point  \nin the transformation. The Board has monitored \nprogress of programmes to enhance M&S’ utilisation \nof data including Sparks, Personalisation at Scale and \nBEAM Academy. \nDecisions and s.172 considerations\n– \nThe Board supported investment in the True \nCapital III Fund to enrich M&S’ understanding  \nof changing customer priorities, such as \nsustainability and convenience, through access  \nto emerging technology. ",
        "marker": "Macro Issue How",
        "confidence": 65
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "GROUP PURPOSE UPDATE 1  2  3  4  5\nSTRATEGY AND TRANSFORMATION\nStakeholder \ngroups: \n Shareholders \n Colleagues \n Suppliers \n Customers \n Communities \n Partners\nStrategic \npriorities: \nM&S Food  \nhigh-performing \nbusiness and \nmarket share \ngrowth\nOcado \ntransitioning to \nstrong capacity \ngrowth post \npandemic \nreversion\nClothing & \nHome on track \nfor a more \nprofitable  \nmodel capable \nof growth\nBuilding store \nrotation \npipeline,  \ndriving exit from \nlegacy stores\nInternational \nabsorbing Brexit \nrelated costs, \nbut embryonic \nglobal strategy \nencouraging\n3\n4\n5\n2\n1\nMarks and Spencer Group plc\n64\nGOVERNANCE\nBudget and financial performance  \n1  2  3  4  5\nFinancial performance was monitored by the  \nBoard at every meeting, with deep dives on financial \nresults announcements, in-year budget and the \nthree-year plan. \nDecisions and s.172 considerations\n– \nManagement re-forecasts were robustly \nscrutinised by the Board, leading to two market \nannouncements increasing profit outlook \nguidance. ",
        "marker": "Purpose",
        "confidence": 70
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– \nThe Board debated the Company’s cost base, \nparticularly in light of macroeconomic factors such \nas inflation. Discussing the impact on customers \nand partners in terms of pricing and supply \nstrategy, it was agreed an emphasis on internal \nefficiency would remain vital. ",
        "marker": "Tensions",
        "confidence": 60
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Balance sheet management  \n1  2  3  4  5\nAs the business recovered from Covid, balance  \nsheet management remained a critical component  \nin sustainability of the Company’s performance.\nDecisions and s.172 considerations\n– \nThe Board considered broad stakeholder support \nin agreeing the new £850m revolving credit facility, \nwhich was linked to net zero sustainability metrics. ",
        "marker": "Tensions",
        "confidence": 55
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Invasion of Ukraine 5\nFollowing the invasion of Ukraine by Russia,  \nthe Board rapidly engaged in crisis discussions  \nand closely monitored the unfolding situation. \nDecisions and s.172 considerations\n– \nThe Board unanimously agreed that colleague \nwelfare was the Company’s main priority and \nencouraged management’s plans to support  \nthe humanitarian crisis. ",
        "marker": "Tensions",
        "confidence": 70
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– \nDetailed discussions took place on the challenges \ninvolved in suspending shipments to the Turkish \nfranchisee’s Russian business, and continuing to \nsupply franchise stores in Ukraine. The Board \ncontinue to receive regular updates on how the \nconflict is impacting our franchise partner, \nsuppliers, colleagues, charity partners  \nand investors. ",
        "marker": "Tensions",
        "confidence": 65
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Brexit and Covid-19 1  2  3  4  5\nDespite the easing of restrictions, the challenges  \nand opportunities arising from Covid-19, and the \nongoing impact and management of Brexit, remained \nregular topics in the boardroom during 2021/22. \nDecisions and s.172 considerations\n– \nDeep dive discussions on the markets most  \nheavily impacted by Brexit, mindful of the diversity \nof customer perceptions. The Board agreed ways \nto best meet customer and community needs, \ninstructing that partners with strong local \nknowledge should be sought and local sourcing \nshould be engaged wherever possible.  ",
        "marker": "Tensions",
        "confidence": 60
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– \nRegular updates on Covid-19 cases, restrictions \nand trading patterns were monitored across all \nmarkets and sourcing locations. The Board \nconsidered colleague welfare and continuity  \nrisks, instructing a renewal of contingency  \nplans for the Castle Donington distribution centre. ",
        "marker": "Tensions",
        "confidence": 55
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Third-party brands 3  5\nThe Board reviewed brand proposals and received \nprogress reports on third-party brand performance \nagainst a balanced scorecard, discussing potential \nstructuring models, with both short-term and \nlong-term objectives, and how they would support \nthe M&S “ecosystem”. \nDecisions and s.172 considerations\n– \nThe Board considered how customer and brand \npartner propositions should be balanced. In doing \nso, directors reviewed the results of Customer \nPulse Surveys and agreed the need to take a \nsimplified and well-articulated position to improve \ncustomer understanding. Agreeing also that a \nclear stance would also support brand partners  \nto curate their own offering. ",
        "marker": "Collaboration",
        "confidence": 70
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Risk appetite 1  2  3  4  5\nGroup-wide risk appetite is set by the Board through a \nseries of assessments at individual business unit level, \nfollowed by collective Board debate. See pages 45  \nto 46 for further information. \nDecisions and s.172 considerations\n– \nData-related risk was debated, with the Board \nconcluding to separate risks associated with \ncustomer data versus utilising technology to drive \nthe digital and data agenda more broadly. It was \nagreed there would be no risk appetite in the \nformer category. ",
        "marker": "Tensions",
        "confidence": 65
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Business Involvement Group (“BIG”)  \n1  2  3  4  5\nThe Chair of National BIG was invited to several Board \nmeetings throughout the year, with two “deep dive” \ndiscussions dedicated to colleague engagement  \nand feedback. \nDecisions and s.172 considerations\n– \nColleague feedback was considered in relation to \npay reviews, the holiday buy programme and the \nSave As You Earn share scheme. ",
        "marker": "Collaboration",
        "confidence": 70
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Talent 1  2  3  4  5\nFollowing discussion at the Remuneration Committee, \nthe Board considered an update on talent acquisition, \ndevelopment and retention. \nDecisions and s.172 considerations\n– \nThe Board supported the “internal first” approach \nto growing talent and improving diversity in the \nworkforce. ",
        "marker": "Collaboration",
        "confidence": 75
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Board evaluation\nLast year’s external evaluator held regular sessions \nwith the Board, including an all-Board deep dive,  \nto monitor and review Board effectiveness, as well  \nas progress with last year’s Board action plan.  \nSee page 65 for further information. \nDecisions and s.172 considerations\n– \nConsideration was given to the Colleague \nEngagement Survey results, in line with the Board’s \naction to ensure that people and culture are at the \nheart of the Company’s transformation. With the \nBoard agreeing it should focus on development  \nof other senior leadership in addition to ExCo. \nBoard committees\nThe principal Committee meetings are aligned to  \nthe cadence of the Board calendar, with the Chair  \nof each Committee providing the Board with their  \nlatest updates and recommendations for approval. \nDecisions and s.172 considerations\n– \nThe Board debated the Remuneration Committee \nrecommendation on an inflationary pay rise  \nacross the Group, considering cost of living \npressures. ",
        "marker": "Tensions",
        "confidence": 70
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Year-end controls and approvals \nAfter a series of briefings on planning, and following \nreview and recommendation from the principal \nCommittees, the Board considered the year-end \napproval matrix. \nDecisions and s.172 considerations\n– \nDetailed sessions on the Full Year Results and  \nthe Annual Report included rigorous debate and \nscrutiny on principal risks, investor returns, more \ncustomer-centric messaging, and communicating \ncolleague recognition. ",
        "marker": "Tensions",
        "confidence": 65
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "Shareholder analysis and engagement \nThe Board reviewed regular updates on analysis of  \nthe M&S share register and reports on the priorities  \nof institutional investors and proxy voting agencies. \nDecisions and s.172 considerations\n– \nConsideration was given to investors’ increased \nfocus on ESG activities and the Company’s  \nrecord on plastic was agreed as a focus area  \nfor management. ",
        "marker": "Tensions",
        "confidence": 70
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Reviews the principal risks twice a year, of which  \nclimate change and environmental responsibility is one.\nAudit Committee",
        "marker": "Tensions",
        "confidence": 60
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Advises the Audit Committee on ESG-related risks and \nopportunities, including climate-related issues.\nESG Committee",
        "marker": "Purpose",
        "confidence": 65
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– The Executive Committee members are individually responsible for reviewing and confirming risks in their own areas,  \nincluding climate risks.\nExecutive Committee",
        "marker": "Agency",
        "confidence": 70
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Responsible for ensuring climate-related risks are \nconsidered as part of the business’ risk register.\nBusiness and Functional Leadership Teams",
        "marker": "Micro Issue How",
        "confidence": 55
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Ensures net zero strategy considerations are included \nwithin financial planning cycles.\nPlan A (Net Zero) Steering Group",
        "marker": "Macro Issue How",
        "confidence": 60
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Evaluated the plans to rotate the store \nestate, considering risks relating to \ninflationary pressures on renewal costs, \nsustainability factors, and the potential \nneed to expand human resources to \nmaintain and accelerate pace. The \naccounting treatment of the store \nprogramme was also debated and agreed \nwith the external auditors. ",
        "marker": "Tensions",
        "confidence": 65
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Evaluated the risks arising from delivery of \nPlan A commitments in light of the scale \nand complexity of the net zero challenge, \nand risks arising from the introduction of \nthird-party brands. Considered and agreed \ncontrols to manage these and other \nchanges, including creation of a new  \nFinance role. ",
        "marker": "Tensions",
        "confidence": 60
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Monitored compliance in the supply  \nchain with emphasis on modern slavery, \nchild labour, chemicals and product  \nsafety regulations, including a return to \nin-person audits.\nFood",
        "marker": "Micro Issue How",
        "confidence": 55
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Reviewed and assessed risks relating to \nOcado Retail, from the launch of new \nproducts on the platform through to \nfinancial and strategic impacts of the  \njoint venture. \n – Considered GSCOP compliance, agreed on \nadditional training for suppliers and monitored \nthe supply chain transformation risk.",
        "marker": "Micro Issue How",
        "confidence": 60
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Discussed and agreed stronger controls  \nand process adherence in food product \ndevelopment and food safety. \nInternational",
        "marker": "Collaboration",
        "confidence": 70
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Evaluated the mitigating actions presented \nby management against Brexit and differing \nresponses to Covid-19 in local jurisdictions. \nBank & Services",
        "marker": "Tensions",
        "confidence": 65
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Assessed cyber security risk and instigated \na review of existing insurance policies. Later \nin the year, the Committee evaluated the \npotential security impact of the invasion of \nUkraine and reviewed actions to manage the \nincreased threat. \n – Monitored the technology transformation and \ndiscussed key areas of risk including available \ntalent resource, quarterly investment \nassessments, cloud migration and compliance \nwith payment data standards. \nHR",
        "marker": "Tensions",
        "confidence": 60
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "–  Are the KPIs disclosed at an appropriate \nlevel based on the financial reporting? \nIS THE REPORT BALANCED? ",
        "marker": "Tensions",
        "confidence": 55
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "–  How do the significant issues identified \ncompare with the risks that Deloitte \nplans to include in its report? \nIS THE REPORT UNDERSTANDABLE?",
        "marker": "Tensions",
        "confidence": 60
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– starting with colleague pay that \nwas calculated based on actual \nbase pay, benefits, bonus and long-\nterm incentives for the 12 monthly \npayrolls within the full financial year. \nEarnings for part-time colleagues are \nannualised on a full-time equivalent \nbasis to allow equal comparisons.",
        "marker": "Micro Issue How",
        "confidence": 50
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Salaries are set by the Committee, taking into consideration a number of factors, including the current pay for other  \nexecutive directors, the experience, skill and current pay level of the individual and external market forces.\nBenefits",
        "marker": "Micro Issue How",
        "confidence": 55
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Lead and develop a successful rhythm and effective ways of  \nworking with new executive team. Leadership and governance of \nExecutive Committee.",
        "marker": "Collaboration",
        "confidence": 70
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– Create a high performing and engaged culture across the whole  \nof M&S.\nKatie \nBickerstaffe\n70%\n30%",
        "marker": "Purpose",
        "confidence": 65
    },
    {
        "company": "Marks and Spencer",
        "year": "2022",
        "paragraph": "– There will be a period of economic recession in the UK in 2022/23 \nand 2023/24 (following the impacts of the Covid-19 pandemic, \nthe unfolding humanitarian crisis following the invasion  \nof Ukraine and the subsequent sharp increases in the cost  \nof living), resulting in a decline in sales of 4.0% per annum, \nacross all three business units.",
        "marker": "Macro Issue Why",
        "confidence": 60
    }
];

        const googleScriptURL = 'https://script.google.com/macros/s/AKfycbzsZwKPYMKWFjHazKIIvAtNxqr3Ky0NenMnI2Fy0tV-WH19-7pM93me8NjXdiaC_49O/exec';

        const markerDefinitions = {
            "Purpose": "The company discusses explicitly about its 'purpose' (reason for being of the company) aiming towards a desired state in the future.",
            "Tensions": "The company discusses engaging in certain behaviors (systems thinking) despite potential unfavorable conditions.",
            "Macro Issue Why": "The company explains 'why' they consider a macro issue important for the firm, indicating how the system impacts them (zooming out).",
            "Macro Issue How": "The company details specific initiatives (A, B, and C) to address systems problems at the organizational level, focusing on the process (zooming out).",
            "Micro Issue Why": "The company explains 'why' a micro issue is important, highlighting how the system impacts them (zooming in).",
            "Micro Issue How": "The company discusses specific initiatives to tackle systems problems at a micro level (zooming in).",
            "Collaboration": "The company discusses collaboration with other stakeholders (system actors) to address systems problems.",
            "Agency": "The company discusses actions the company can take to transform the system, reflecting a proactive stance and impact beyond the organization."
        };

        let currentParagraphIndex = 0;

        document.addEventListener('DOMContentLoaded', function() {
            loadParagraph(currentParagraphIndex);
            updateIndexSelector();
            populateMarkerOptions();
            populateDefinitionsTable();

            document.getElementById('feedbackForm').addEventListener('submit', function(event) {
                event.preventDefault();
                submitFeedback();
            });

            document.getElementById('jsonIndexSelector').addEventListener('change', function() {
                currentParagraphIndex = parseInt(this.value);
                loadParagraph(currentParagraphIndex);
            });

            document.getElementById('addMarkerForm').addEventListener('submit', function(event) {
                event.preventDefault();
                addMarker();
            });
        });

        function updateIndexSelector() {
            const selector = document.getElementById('jsonIndexSelector');
            selector.innerHTML = '';
            jsonData.forEach((_, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.text = `Paragraph ${index + 1}`;
                selector.appendChild(option);
            });
        }

        function loadParagraph(index) {
            if (!jsonData.length || index < 0 || index >= jsonData.length) {
                const container = document.getElementById('paragraphContainer');
                container.innerHTML = '<p>No paragraph available.</p>';
                return;
            }

            const item = jsonData[index];
            const container = document.getElementById('paragraphContainer');
            container.innerHTML = `
                <p>Paragraph ${index + 1} of ${jsonData.length}:</p>
                <p>${item.paragraph}</p>
                <p>Company: ${item.company}, Year: ${item.year}</p>
                <div id="markerButtonsContainer"></div>
                <div id="markerFeedbackContainer" class="markerFeedbackContainer"></div>
                <hr>`;

            loadMarkerButtons(item);
            loadMarkerFeedback(item);
        }

        function loadMarkerButtons(item) {
            const container = document.getElementById('markerButtonsContainer');
            container.innerHTML = '';

            for (let key in item) {
                if (key.startsWith('marker') && item[key]) {
                    const markerKey = key;
                    const markerName = item[key];
                    const confidenceKey = key.replace('marker', 'confidence');
                    const confidenceValue = item[confidenceKey];

                    const button = document.createElement('button');
                    button.className = 'markerButton';
                    if (confidenceValue !== undefined) {
                        button.textContent = `${markerName} (${confidenceValue}%)`;
                    } else {
                        button.textContent = markerName;
                    }
                    container.appendChild(button);
                }
            }
        }

        function loadMarkerFeedback(item) {
            const container = document.getElementById('markerFeedbackContainer');
            container.innerHTML = '';

            for (let key in item) {
                if (key.startsWith('marker') && item[key]) {
                    const markerKey = key;
                    const markerName = item[key];
                    const confidenceKey = key.replace('marker', 'confidence');
                    const confidenceValue = item[confidenceKey];

                    // Create elements for markerName and confidence
                    const markerDiv = document.createElement('div');
                    markerDiv.className = 'markerDiv';

                    const markerLabel = document.createElement('label');
                    markerLabel.textContent = `Marker: ${markerName}`;
                    markerDiv.appendChild(markerLabel);

                    // Confidence Level (only if it exists)
                    if (confidenceValue !== undefined) {
                        const confidenceLabel = document.createElement('label');
                        confidenceLabel.textContent = ` Confidence Level: ${confidenceValue}%`;
                        markerDiv.appendChild(confidenceLabel);
                    }

                    // Agree/Disagree Feedback
                    const feedbackLabel = document.createElement('label');
                    feedbackLabel.textContent = ' Feedback: ';
                    markerDiv.appendChild(feedbackLabel);

                    const select = document.createElement('select');
                    select.className = 'markerFeedback';
                    select.setAttribute('data-marker', markerKey);

                    const optionAgree = document.createElement('option');
                    optionAgree.value = 'agree';
                    optionAgree.text = 'Agree';
                    select.appendChild(optionAgree);

                    const optionDisagree = document.createElement('option');
                    optionDisagree.value = 'disagree';
                    optionDisagree.text = 'Disagree';
                    select.appendChild(optionDisagree);

                    markerDiv.appendChild(select);

                    container.appendChild(markerDiv);
                }
            }
        }

        function submitFeedback() {
            const name = document.getElementById('name').value;
            if (!name) {
                alert('Please fill in your name.');
                return;
            }

            const feedbackData = {
                name: name,
                paragraph: jsonData[currentParagraphIndex].paragraph,
                feedback: []
            };

            const markerDivs = document.querySelectorAll('#markerFeedbackContainer > .markerDiv');
            markerDivs.forEach(div => {
                const markerKey = div.querySelector('.markerFeedback').getAttribute('data-marker');
                const markerName = jsonData[currentParagraphIndex][markerKey];
                const feedbackValue = div.querySelector('.markerFeedback').value;
                const confidenceKey = markerKey.replace('marker', 'confidence');
                const confidenceValue = jsonData[currentParagraphIndex][confidenceKey];

                feedbackData.feedback.push({
                    markerKey: markerKey,
                    markerName: markerName,
                    feedback: feedbackValue,
                    confidence: confidenceValue // May be undefined for new markers
                });
            });

            // Send feedback to Google Sheets
            fetch(googleScriptURL, {
                method: 'POST',
                body: JSON.stringify(feedbackData),
                headers: {
                    'Content-Type': 'application/json'
                },
                mode: 'no-cors'
            })
            .then((response) => {
                alert('Feedback submitted successfully.');
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('There was an error submitting the feedback.');
            });
        }

        function populateMarkerOptions() {
            const markerSelect = document.getElementById('newMarker');
            markerSelect.innerHTML = '';

            for (let key in markerDefinitions) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key;
                markerSelect.appendChild(option);
            }
        }

        function addMarker() {
            const markerKeyIndex = Object.keys(jsonData[currentParagraphIndex]).filter(key => key.startsWith('marker')).length + 1;
            const markerKey = `marker${markerKeyIndex > 1 ? markerKeyIndex : ''}`;
            const markerName = document.getElementById('newMarker').value;

            if (markerName) {
                jsonData[currentParagraphIndex][markerKey] = markerName;

                loadParagraph(currentParagraphIndex);
            } else {
                alert('Please select a marker.');
            }
        }

        function populateDefinitionsTable() {
            const tableBody = document.getElementById('definitionsTableBody');
            tableBody.innerHTML = '';

            for (let key in markerDefinitions) {
                const row = document.createElement('tr');

                const dimensionCell = document.createElement('td');
                dimensionCell.textContent = key;
                row.appendChild(dimensionCell);

                const definitionCell = document.createElement('td');
                definitionCell.textContent = markerDefinitions[key];
                row.appendChild(definitionCell);

                tableBody.appendChild(row);
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Reinforcement Learning Feedback</h1>

        <div id="paragraphContainer">
            <!-- Paragraph will be loaded here -->
        </div>
        
        <div id="markerButtonsContainer">
            <!-- Markers and their confidence levels will be loaded here -->
        </div>

        <div id="markerFeedbackContainer" class="markerFeedbackContainer">
            <!-- Marker-specific feedback will be loaded here -->
        </div>
        
        <form id="addMarkerForm">
            <label for="newMarker">New Marker:</label>
            <select id="newMarker" name="newMarker" class="classificationDropdown"></select>
            <button class="addMarkerButton" type="submit">Add Marker</button>
        </form>

        <hr>

        <form id="feedbackForm">
            <label for="jsonIndexSelector">Select Paragraph:</label>
            <select id="jsonIndexSelector" name="jsonIndexSelector" class="classificationDropdown"></select>
            <br>
            <label for="name">Your Name:</label>
            <input type="text" id="name" name="name" class="nameInput">
            <button class="submitFeedback" type="submit">Submit</button>
        </form>

        <table>
            <thead>
                <tr>
                    <th>Dimension</th>
                    <th>Definition</th>
                </tr>
            </thead>
            <tbody id="definitionsTableBody">
                <!-- Definitions will be populated here -->
            </tbody>
        </table>
    </div>
</body>
</html>
