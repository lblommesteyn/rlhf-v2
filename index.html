<!DOCTYPE html>
<html>
<head>
    <title>Reinforcement Learning Feedback</title>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Open+Sans&display=swap");

        body {
            background-color: #f4f7fc;
            font-family: "Open Sans", sans-serif;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f7fc;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        .classificationDropdown, .nameInput {
            margin-bottom: 10px;
            display: block;
            width: 100%;
        }

        .submitFeedback, .submitName, .addMarkerButton {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
        }

        .markerFeedbackContainer {
            margin-bottom: 15px;
        }

        .markerButton {
            margin-right: 10px;
        }

        hr {
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f4f4f4;
        }
    </style>
    <script>
    let jsonData = [
    {
        "company": "Debenhams",
        "year": "2018",
        "paragraph": "Emissions data are made more meaningful when compared to a core business variable. We have used intensity ratios, alongside the absolute figures provided above, to report our GHG emissions in the context of our annual turnover and premises floor area.",
        "marker": "Macro Issue How"
    },
    {
        "company": "Debenhams",
        "year": "2018",
        "paragraph": "A robust systems infrastructure is required to support the delivery of our strategic objectives which are outlined on page 7.",
        "marker": "Micro Issue How"
    },
    {
        "company": "Debenhams",
        "year": "2018",
        "paragraph": "Information systems developments are key enablers and critical to ensure we can compete effectively, and these are monitored through a business change roadmap.",
        "marker": "Micro Issue How"
    },
    {
        "company": "Debenhams",
        "year": "2018",
        "paragraph": "Property lease incentives received from landlords, either through developers’ contributions or rent-free periods, are recognised as non-current liabilities and are credited to the income statement on a straight line basis over the term of the relevant lease. Property lease incentives received also relate to the spreading of the charges in respect of leases with fixed annual increments in rent (escalating rent clauses) over the term of the relevant lease.",
        "marker": "Macro Issue How"
    },
    {
        "company": "Debenhams",
        "year": "2018",
        "paragraph": "The Group leases department stores, warehouses and offices under non-cancellable operating leases. The leases have various terms including escalating rent and contingent turnover rent clauses and renewal rights. The Group has pre-emption rights over a number of properties, which provides the Group with the right of first refusal to purchase the property in the event the landlord chooses to sell. The option price payable for the property in each instance is referenced to current market value prevailing at the point of pre-emption.",
        "marker": "Macro Issue How"
    },
    {
        "company": "Debenhams",
        "year": "2018",
        "paragraph": "An award under the PSP will normally vest on the third anniversary of date of grant and must be exercised within six months of vesting. No payment is required for the grant of an award. An award under the PSP comprises a right to receive free shares or a nil cost option with performance conditions attached.",
        "marker": "Micro Issue How"
    },
    {
        "company": "Debenhams",
        "year": "2018",
        "paragraph": "Performance will be assessed on a ranked basis, with 25% of the award vesting for median performance and 100% of the award vesting for upper-quartile performance. In accordance with IFRS 2 “Share-based payments,” the shares have been fair valued using a Monte Carlo or Black-Scholes model assuming the inputs in the table below.",
        "marker": "Micro Issue How"
    },
    {
        "company": "Debenhams",
        "year": "2018",
        "paragraph": "Options granted on 1 December 2017 over 253,164 shares have a 36-month vesting period based on the employee’s continued employment within the business and performance targets specific to the employees’ role, and were granted with no exercise price.",
        "marker": "Micro Issue How"
    },
    {
        "company": "Debenhams",
        "year": "2018",
        "paragraph": "The Group’s net promoter score measures the willingness of customers to recommend the Group’s products or services to others. This measure is used for remuneration incentive purposes.",
        "marker": "Micro Issue How"
    },
    {
        "company": "Debenhams",
        "year": "2018",
        "paragraph": "Options were granted with an exercise price equal to the middle market value of the shares on the day immediately preceding the date of grant. The options granted on 24 November 2009 became exercisable in full based on ROCE performance exceeding the cost of capital by 7.8% during the applicable performance period.",
        "marker": "Micro Issue How"
    },
    {
        "company": "Debenhams",
        "year": "2018",
        "paragraph": "The Company leases department stores under non-cancellable operating leases. These leases have various terms including in some cases contingent turnover rent clauses. A subsidiary undertaking continues to occupy and trade from these properties under a letting arrangement with the Company.",
        "marker": "Macro Issue How"
    },
    {
        "company": "Debenhams",
        "year": "2018",
        "paragraph": "The Company is subject to litigation from time to time as a result of its activities. The Company establishes provisions in connection with litigation where it has a present legal or constructive obligation as a result of past events and where it is more likely than not an outflow of resources will be required to settle the obligation and the amount can be reliably estimated.",
        "marker": "Macro Issue How"
    }
    ];

    const googleScriptURL = 'https://script.google.com/macros/s/AKfycbzsZwKPYMKWFjHazKIIvAtNxqr3Ky0NenMnI2Fy0tV-WH19-7pM93me8NjXdiaC_49O/exec';

    const markerDefinitions = {
        "Purpose": "The company discusses explicitly about its 'purpose' (reason for being of the company) aiming towards a desired state in the future.",
        "Tensions": "The company discusses engaging in certain behaviors (systems thinking) despite potential unfavorable conditions.",
        "Macro Issue Why": "The company explains 'why' they consider a macro issue important for the firm, indicating how the system impacts them (zooming out).",
        "Macro Issue How": "The company details specific initiatives (A, B, and C) to address systems problems at the organizational level, focusing on the process (zooming out).",
        "Micro Issue Why": "The company explains 'why' a micro issue is important, highlighting how the system impacts them (zooming in).",
        "Micro Issue How": "The company discusses specific initiatives to tackle systems problems at a micro level (zooming in).",
        "Collaboration": "The company discusses collaboration with other stakeholders (system actors) to address systems problems.",
        "Agency": "The company discusses actions the company can take to transform the system, reflecting a proactive stance and impact beyond the organization."
    };

    let currentParagraphIndex = 0;

    document.addEventListener('DOMContentLoaded', function() {
        loadParagraph(currentParagraphIndex);
        updateIndexSelector();
        populateMarkerOptions();
        populateDefinitionsTable();

        document.getElementById('feedbackForm').addEventListener('submit', function(event) {
            event.preventDefault();
            submitFeedback();
        });

        document.getElementById('jsonIndexSelector').addEventListener('change', function() {
            currentParagraphIndex = parseInt(this.value);
            loadParagraph(currentParagraphIndex);
        });

        document.getElementById('addMarkerForm').addEventListener('submit', function(event) {
            event.preventDefault();
            addMarker();
        });
    });

    function updateIndexSelector() {
        const selector = document.getElementById('jsonIndexSelector');
        selector.innerHTML = '';
        jsonData.forEach((_, index) => {
            const option = document.createElement('option');
            option.value = index;
            option.text = `Paragraph ${index + 1}`;
            selector.appendChild(option);
        });
    }

    function loadParagraph(index) {
        if (!jsonData.length || index < 0 || index >= jsonData.length) {
            const container = document.getElementById('paragraphContainer');
            container.innerHTML = '<p>No paragraph available.</p>';
            return;
        }

        const item = jsonData[index];
        const container = document.getElementById('paragraphContainer');
        container.innerHTML = `
            <p>Paragraph ${index + 1} of ${jsonData.length}:</p>
            <p>${item.paragraph}</p>
            <p>Company: ${item.company}, Year: ${item.year}</p>
            <div id="markerButtonsContainer"></div>
            <div id="markerFeedbackContainer" class="markerFeedbackContainer"></div>
            <hr>`;

        loadMarkerButtons(item);
        loadMarkerFeedback(item);
    }

    function loadMarkerButtons(item) {
        const container = document.getElementById('markerButtonsContainer');
        container.innerHTML = '';

        for (let key in item) {
            if (key.startsWith('marker') && item[key]) {
                const button = document.createElement('button');
                button.className = 'markerButton';
                button.textContent = item[key];
                container.appendChild(button);
            }
        }
    }

    function loadMarkerFeedback(item) {
        const container = document.getElementById('markerFeedbackContainer');
        container.innerHTML = '';

        for (let key in item) {
            if (key.startsWith('marker') && item[key]) {
                const label = document.createElement('label');
                label.textContent = `Feedback for ${item[key]}: `;
                const select = document.createElement('select');
                select.className = 'markerFeedback';
                select.setAttribute('data-marker', key);

                const optionAgree = document.createElement('option');
                optionAgree.value = 'agree';
                optionAgree.text = 'Agree';
                select.appendChild(optionAgree);

                const optionDisagree = document.createElement('option');
                optionDisagree.value = 'disagree';
                optionDisagree.text = 'Disagree';
                select.appendChild(optionDisagree);

                container.appendChild(label);
                container.appendChild(select);
                container.appendChild(document.createElement('br'));
            }
        }
    }

    function submitFeedback() {
        const feedback = {
            name: document.getElementById('name').value,
            paragraph: jsonData[currentParagraphIndex].paragraph,
            feedback: {},
            marker: jsonData[currentParagraphIndex].marker
        };

        const markerFeedbackElements = document.querySelectorAll('.markerFeedback');
        markerFeedbackElements.forEach(element => {
            const markerKey = element.getAttribute('data-marker');
            feedback.feedback[markerKey] = element.value;
        });

        if (!feedback.name) {
            alert('Please fill in your name.');
            return;
        }

        // Send feedback to Google Sheets
        fetch(googleScriptURL, {
    method: 'POST',
    body: JSON.stringify({
        name: feedback.name,
        paragraph: feedback.paragraph,
        feedback: JSON.stringify(feedback.feedback),
        marker: feedback.marker
    }),
    headers: {
        'Content-Type': 'application/json'
    },
    mode: 'no-cors'
})
.then((response) => {
    alert('Feedback submitted successfully.');
})
.catch((error) => {
    console.error('Error:', error);
    alert('There was an error submitting the feedback.');
});
    }

    function populateMarkerOptions() {
        const markerSelect = document.getElementById('newMarker');
        markerSelect.innerHTML = '';

        for (let key in markerDefinitions) {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = key;
            markerSelect.appendChild(option);
        }
    }

    function addMarker() {
        const markerKey = `marker${Object.keys(jsonData[currentParagraphIndex]).filter(key => key.startsWith('marker')).length + 1}`;
        const markerName = document.getElementById('newMarker').value;

        if (markerName) {
            jsonData[currentParagraphIndex][markerKey] = markerName;

            loadParagraph(currentParagraphIndex);
        } else {
            alert('Please select a marker.');
        }
    }

    function populateDefinitionsTable() {
        const tableBody = document.getElementById('definitionsTableBody');
        tableBody.innerHTML = '';

        for (let key in markerDefinitions) {
            const row = document.createElement('tr');

            const dimensionCell = document.createElement('td');
            dimensionCell.textContent = key;
            row.appendChild(dimensionCell);

            const definitionCell = document.createElement('td');
            definitionCell.textContent = markerDefinitions[key];
            row.appendChild(definitionCell);

            tableBody.appendChild(row);
        }
    }
    </script>
</head>
<body>
    <div class="container">
        <h1>Reinforcement Learning Feedback</h1>

        <div id="paragraphContainer">
            <!-- Paragraph will be loaded here -->
        </div>
        
        <div id="markerButtonsContainer">
            <!-- AI's coding will be loaded here -->
        </div>

        <div id="markerFeedbackContainer" class="markerFeedbackContainer">
            <!-- Marker-specific feedback will be loaded here -->
        </div>
        
        <form id="addMarkerForm">
            <label for="newMarker">New Marker:</label>
            <select id="newMarker" name="newMarker" class="classificationDropdown"></select>
            <button class="addMarkerButton" type="submit">Add Marker</button>
        </form>

        <hr>

        <form id="feedbackForm">
            <label for="jsonIndexSelector">Select Paragraph:</label>
            <select id="jsonIndexSelector" name="jsonIndexSelector" class="classificationDropdown"></select>
            <br>
            <label for="name">Your Name:</label>
            <input type="text" id="name" name="name" class="nameInput">
            <button class="submitFeedback" type="submit">Submit</button>
        </form>

        <table>
            <thead>
                <tr>
                    <th>Dimension</th>
                    <th>Definition</th>
                </tr>
            </thead>
            <tbody id="definitionsTableBody">
                <!-- Definitions will be populated here -->
            </tbody>
        </table>
    </div>
</body>
</html>
